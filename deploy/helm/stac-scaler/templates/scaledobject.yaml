{{- range $key, $value := .Values.processors }}
---
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: {{ $key }}
  namespace: {{ $.Values.namespace }}
spec:
  scaleTargetRef:
    kind: Deployment
    name: {{ $value.template }}
  pollingInterval: {{ $value.pollingInterval }}
  minReplicaCount: {{ $value.minReplicaCount }}
  maxReplicaCount: {{ $value.maxReplicaCount }}
  triggers:
  - type: azure-servicebus
    metadata:
      namespace: {{ $value.namespace }}
      topicName: {{ $value.topicName }}
      subscriptionName: {{ $value.subscriptionName }}
      messageCount: "{{ $value.messageCount }}"
    authenticationRef:
        name: {{ $value.authenticationRef }}
---
{{- end }}
